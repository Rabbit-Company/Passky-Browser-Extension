/*
Blake2b-JS v1.0.0
https://github.com/Rabbit-Company/Blake2b-JS
License: GPL-3.0
*/
class Blake2b{v=new Uint32Array(32);m=new Uint32Array(32);BLAKE2B_IV32=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]);SIGMA8=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3];parameterBlock=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);SIGMA82=new Uint8Array(this.SIGMA8.map(function(t){return 2*t}));ADD64AA(t,_,$){let e=t[_]+t[$],i=t[_+1]+t[$+1];e>=4294967296&&i++,t[_]=e,t[_+1]=i}ADD64AC(t,_,$,e){let i=t[_]+$;$<0&&(i+=4294967296);let h=t[_+1]+e;i>=4294967296&&h++,t[_]=i,t[_+1]=h}B2B_GET32(t,_){return t[_]^t[_+1]<<8^t[_+2]<<16^t[_+3]<<24}B2B_G(t,_,$,e,i,h){let s=this.m[i],l=this.m[i+1],r=this.m[h],a=this.m[h+1];this.ADD64AA(this.v,t,_),this.ADD64AC(this.v,t,s,l);let n=this.v[e]^this.v[t],A=this.v[e+1]^this.v[t+1];this.v[e]=A,this.v[e+1]=n,this.ADD64AA(this.v,$,e),n=this.v[_]^this.v[$],A=this.v[_+1]^this.v[$+1],this.v[_]=n>>>24^A<<8,this.v[_+1]=A>>>24^n<<8,this.ADD64AA(this.v,t,_),this.ADD64AC(this.v,t,r,a),n=this.v[e]^this.v[t],A=this.v[e+1]^this.v[t+1],this.v[e]=n>>>16^A<<16,this.v[e+1]=A>>>16^n<<16,this.ADD64AA(this.v,$,e),n=this.v[_]^this.v[$],A=this.v[_+1]^this.v[$+1],this.v[_]=A>>>31^n<<1,this.v[_+1]=n>>>31^A<<1}blake2bCompress(t,_){let $=0;for($=0;$<16;$++)this.v[$]=t.h[$],this.v[$+16]=this.BLAKE2B_IV32[$];for(this.v[24]=this.v[24]^t.t,this.v[25]=this.v[25]^t.t/4294967296,_&&(this.v[28]=~this.v[28],this.v[29]=~this.v[29]),$=0;$<32;$++)this.m[$]=this.B2B_GET32(t.b,4*$);for($=0;$<12;$++)this.B2B_G(0,8,16,24,this.SIGMA82[16*$+0],this.SIGMA82[16*$+1]),this.B2B_G(2,10,18,26,this.SIGMA82[16*$+2],this.SIGMA82[16*$+3]),this.B2B_G(4,12,20,28,this.SIGMA82[16*$+4],this.SIGMA82[16*$+5]),this.B2B_G(6,14,22,30,this.SIGMA82[16*$+6],this.SIGMA82[16*$+7]),this.B2B_G(0,10,20,30,this.SIGMA82[16*$+8],this.SIGMA82[16*$+9]),this.B2B_G(2,12,22,24,this.SIGMA82[16*$+10],this.SIGMA82[16*$+11]),this.B2B_G(4,14,16,26,this.SIGMA82[16*$+12],this.SIGMA82[16*$+13]),this.B2B_G(6,8,18,28,this.SIGMA82[16*$+14],this.SIGMA82[16*$+15]);for($=0;$<16;$++)t.h[$]=t.h[$]^this.v[$]^this.v[$+16]}blake2bInit(t,_,$,e){if(0===t||t>64)throw Error("Illegal output length, expected 0 < length <= 64");if(_&&_.length>64)throw Error("Illegal key, expected Uint8Array with 0 < length <= 64");if($&&16!==$.length)throw Error("Illegal salt, expected Uint8Array with length is 16");if(e&&16!==e.length)throw Error("Illegal personal, expected Uint8Array with length is 16");let i={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};this.parameterBlock.fill(0),this.parameterBlock[0]=t,_&&(this.parameterBlock[1]=_.length),this.parameterBlock[2]=1,this.parameterBlock[3]=1,$&&this.parameterBlock.set($,32),e&&this.parameterBlock.set(e,48);for(let h=0;h<16;h++)i.h[h]=this.BLAKE2B_IV32[h]^this.B2B_GET32(this.parameterBlock,4*h);return _&&(this.blake2bUpdate(i,_),i.c=128),i}blake2bUpdate(t,_){for(let $=0;$<_.length;$++)128===t.c&&(t.t+=t.c,this.blake2bCompress(t,!1),t.c=0),t.b[t.c++]=_[$]}blake2bFinal(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;this.blake2bCompress(t,!0);let _=new Uint8Array(t.outlen);for(let $=0;$<t.outlen;$++)_[$]=t.h[$>>2]>>8*(3&$);return _}blake2bStart(t,_,$,e,i){$=$||64,t=this.normalizeInput(t),e&&(e=this.normalizeInput(e)),i&&(i=this.normalizeInput(i));let h=this.blake2bInit($,_,e,i);return this.blake2bUpdate(h,t),this.blake2bFinal(h)}blake2bHex(t,_,$,e,i){let h=blake2bStart(t,_,$,e,i);return toHex(h)}normalizeInput(t){let _;if(t instanceof Uint8Array)_=t;else if("string"==typeof t){let $=new TextEncoder;_=$.encode(t)}else throw Error("Input must be an string, Buffer or Uint8Array");return _}toHex(t){return Array.prototype.map.call(t,function(t){return(t<16?"0":"")+t.toString(16)}).join("")}static hash(t,_,$=64,e,i){let h=new Blake2b,s=h.blake2bStart(t,_,$,e,i);return h.toHex(s)}}
/*
Argon2id-JS v1.1.0
https://github.com/Rabbit-Company/Argon2id-JS
License: GPL-3.0
*/
const memo={};let context=null;function LE32(e){let t=new Uint8Array(4);return t[0]=e,t[1]=e>>8&255,t[2]=e>>16&255,t[3]=e>>24&255,Array.from(t)}function LE64(e){let t=new Uint8Array(8);return t[0]=e,t[1]=e>>8&255,t[2]=e>>16&255,t[3]=e>>24&255,Array.from(t)}function toHex(e){return Array.prototype.map.call(e,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function extract(e,t){return 0==t?Uint8ArrayToBigInt(e.slice(0,4)):1==t?Uint8ArrayToBigInt(e.slice(4,8)):void 0}function NumberToUint8Array(e){var t=[];let n=Math.ceil(Math.floor(Math.log2(new Number(e))+1)/8);for(let r=0;r<n;r++)t.unshift(new Number(255n&e)),e>>=8n;return new Uint8Array(t).reverse()}function Uint8ArrayToBigInt(e){let t=0n;for(let n=e.length-1;n>=0;n--)t=BigInt(e[n])|t<<8n;return t}function ZERO(e){return new Uint8Array(e)}function Concatenate(...e){let t=0;e.forEach(e=>{t+=e.length});let n=new Uint8Array(t),r=0;return e.forEach(e=>{n.set(e,r),r+=e.length}),n}function XOR(e,t){let n=new Uint8Array(1024);for(let r=0;r<e.length;r++)n[r]=e[r]^t[r];return n}function MOD(e,t){return(e%t+t)%t}function GB(e,t,n,r){let a=2n**64n-1n,i=BigInt(4294967295),l=r^(e=e+t+BigInt(2)*(e&i)*(t&i)&BigInt.asUintN(64,a));return e=e+(t=(l=t^(n=n+(r=l>>BigInt(32)|(l&i)<<BigInt(32))+BigInt(2)*(n&i)*(r&i)&BigInt.asUintN(64,a)))>>BigInt(24)|(l&BigInt(16777215))<<BigInt(40))+BigInt(2)*(e&i)*(t&i)&BigInt.asUintN(64,a),t=(l=t^(n=n+(r=(l=r^e)>>BigInt(16)|(l&BigInt(65535))<<BigInt(48))+BigInt(2)*(n&i)*(r&i)&BigInt.asUintN(64,a)))>>BigInt(63)|l<<BigInt(1)&BigInt.asUintN(64,a),[e,t,n,r]}function P(e,t,n,r,a,i,l,o){let c,_=Uint8ArrayToBigInt(e.slice(0,8)),s=Uint8ArrayToBigInt(e.slice(8,16)),u=Uint8ArrayToBigInt(t.slice(0,8)),$=Uint8ArrayToBigInt(t.slice(8,16)),g=Uint8ArrayToBigInt(n.slice(0,8)),f=Uint8ArrayToBigInt(n.slice(8,16)),h=Uint8ArrayToBigInt(r.slice(0,8)),b=Uint8ArrayToBigInt(r.slice(8,16)),U=Uint8ArrayToBigInt(a.slice(0,8)),y=Uint8ArrayToBigInt(a.slice(8,16)),A=Uint8ArrayToBigInt(i.slice(0,8)),T=Uint8ArrayToBigInt(i.slice(8,16)),m=Uint8ArrayToBigInt(l.slice(0,8)),E=Uint8ArrayToBigInt(l.slice(8,16)),C=Uint8ArrayToBigInt(o.slice(0,8)),B=Uint8ArrayToBigInt(o.slice(8,16)),O=GB(_,g,U,m);return _=O[0],g=O[1],U=O[2],m=O[3],s=(O=GB(s,f,y,E))[0],f=O[1],y=O[2],E=O[3],u=(O=GB(u,h,A,C))[0],h=O[1],A=O[2],C=O[3],$=(O=GB($,b,T,B))[0],b=O[1],T=O[2],_=(O=GB(_,f,A,B=O[3]))[0],f=O[1],A=O[2],B=O[3],s=(O=GB(s,h,T,m))[0],h=O[1],T=O[2],m=O[3],u=(O=GB(u,b,U,E))[0],b=O[1],U=O[2],E=O[3],$=(O=GB($,g,y,C))[0],g=O[1],y=O[2],C=O[3],_=NumberToUint8Array(_),s=NumberToUint8Array(s),u=NumberToUint8Array(u),$=NumberToUint8Array($),g=NumberToUint8Array(g),f=NumberToUint8Array(f),h=NumberToUint8Array(h),b=NumberToUint8Array(b),U=NumberToUint8Array(U),y=NumberToUint8Array(y),A=NumberToUint8Array(A),T=NumberToUint8Array(T),m=NumberToUint8Array(m),E=NumberToUint8Array(E),C=NumberToUint8Array(C),B=NumberToUint8Array(B),_.length<8&&(c=8-_.length,_=Concatenate(_,ZERO(c))),s.length<8&&(c=8-s.length,s=Concatenate(s,ZERO(c))),u.length<8&&(c=8-u.length,u=Concatenate(u,ZERO(c))),$.length<8&&(c=8-$.length,$=Concatenate($,ZERO(c))),g.length<8&&(c=8-g.length,g=Concatenate(g,ZERO(c))),f.length<8&&(c=8-f.length,f=Concatenate(f,ZERO(c))),h.length<8&&(c=8-h.length,h=Concatenate(h,ZERO(c))),b.length<8&&(c=8-b.length,b=Concatenate(b,ZERO(c))),U.length<8&&(c=8-U.length,U=Concatenate(U,ZERO(c))),y.length<8&&(c=8-y.length,y=Concatenate(y,ZERO(c))),A.length<8&&(c=8-A.length,A=Concatenate(A,ZERO(c))),T.length<8&&(c=8-T.length,T=Concatenate(T,ZERO(c))),m.length<8&&(c=8-m.length,m=Concatenate(m,ZERO(c))),E.length<8&&(c=8-E.length,E=Concatenate(E,ZERO(c))),C.length<8&&(c=8-C.length,C=Concatenate(C,ZERO(c))),B.length<8&&(c=8-B.length,B=Concatenate(B,ZERO(c))),e=Concatenate(_,s),t=Concatenate(u,$),n=Concatenate(g,f),r=Concatenate(h,b),a=Concatenate(U,y),i=Concatenate(A,T),l=Concatenate(m,E),o=Concatenate(C,B),[e,t,n,r,a,i,l,o]}function G(e,t){return new Promise(n=>{let r=XOR(e,t),a=[],i,l;for(let o=0;o<8;o++)l=128*o,(i=P(r.slice(l,l+16),r.slice(l+16,l+32),r.slice(l+32,l+48),r.slice(l+48,l+64),r.slice(l+64,l+80),r.slice(l+80,l+96),r.slice(l+96,l+112),r.slice(l+112,l+128))).forEach(e=>a.push(...e));let c=[];for(let _=0;_<8;_++){l=16*_,(i=P(a.slice(l,l+16),a.slice(l+128,l+128+16),a.slice(l+256,l+256+16),a.slice(l+384,l+384+16),a.slice(l+512,l+512+16),a.slice(l+640,l+640+16),a.slice(l+768,l+768+16),a.slice(l+896,l+896+16))).forEach(e=>a.push(...e));for(let s=0;s<i.length;s++)c=Concatenate(c,i[s])}let u=[];for(let $=0;$<8;$++)l=16*$,u=Concatenate(u,c.slice(l,l+16),c.slice(l+128,l+128+16),c.slice(l+256,l+256+16),c.slice(l+384,l+384+16),c.slice(l+512,l+512+16),c.slice(l+640,l+640+16),c.slice(l+768,l+768+16),c.slice(l+896,l+896+16));n(XOR(u,r))})}function blake2bSetup(e,t=null){context=new Blake2b().blake2bInit(e,t)}function getHash(e,t,n){let r=`hash${e}_${t}_${n}`;if(memo[r])return memo[r];let a=variableLengthHashFunction(1024,Concatenate(e,LE32(t),LE32(n)));return memo[r]=a,a}function variableLengthHashFunction(e,t){if(e<=64)return blake2bSetup(e),r=Concatenate(LE32(e),t),new Blake2b().blake2bUpdate(context,r),new Blake2b().blake2bFinal(context);var n=Math.ceil(e/32)-2,r=Concatenate(LE32(e),t);blake2bSetup(64),new Blake2b().blake2bUpdate(context,r);var a=new Blake2b().blake2bFinal(context),i=a.slice(0,32);for(let l=2;l<=n;l++)blake2bSetup(64),new Blake2b().blake2bUpdate(context,a),i=Concatenate(i,(a=new Blake2b().blake2bFinal(context)).slice(0,32));return blake2bSetup(e-32*n),new Blake2b().blake2bUpdate(context,a),Concatenate(i,a=new Blake2b().blake2bFinal(context))}async function getAddressBlock(e,t,n,r,a,i,l){let o=`${e}_${t}_${n}_${r}_${a}_${i}_${l}`;if(memo[o])return memo[o];let c=Concatenate(LE64(e),LE64(t),LE64(n),LE64(r),LE64(a),LE64(i),LE64(l),ZERO(968)),_=await G(ZERO(1024),await G(ZERO(1024),c));return memo[o]=_,_}async function _fill_segment(e,t,n,r,a,i,l,o,c,_,s,u){var $=1==a||2==a&&0==t&&n<=1;if($)for(var g=[],f=0;g.length<i;){f+=1;let h=await getAddressBlock(t,r,n,_,s,a,f);for(let b=0;b<1024;b+=8)g.push([Uint8ArrayToBigInt(h.slice(b,b+4)),Uint8ArrayToBigInt(h.slice(b+4,b+8))])}for(let U=0;U<i;U++){var y=n*i+U;if(0==t&&y<2){e[r][y]=getHash(l,y,r);continue}var A=NaN,T=NaN;$?(A=g[U][0],T=g[U][1]):(A=extract(e[r][MOD(y-1,o)],0),T=extract(e[r][MOD(y-1,o)],1));var m=NaN;m=0==t&&0==n?r:MOD(T,BigInt(c));var E=NaN;E=0==t?0==n||r==m?y-1:0==U?n*i-1:n*i:r==m?o-i+U-1:0==U?o-i-1:o-i;var C=A**BigInt(2)>>BigInt(32);C=BigInt(E)-BigInt(1)-(BigInt(E)*C>>BigInt(32));var B=0;0!=t&&3!=n&&(B=(n+1)*i);var O=await G(e[r][MOD(y-1,o)],e[m][MOD(BigInt(B)+C,BigInt(o))]);0!=t&&19==u&&(O=XOR(e[r][y],O)),e[r][y]=O}return e[r].slice(n*i,(n+1)*i)}onmessage=function(e){let{type:t,payload:n}=e.data;if("fill-segment"===t){let{B:r,t:a,segment:i,i:l,y:o,segment_Length:c,H_0:_,q:s,p:u,mm:$,time_cost:g,v:f}=n;_fill_segment(r,a,i,l,o,c,_,s,u,$,g,f).then(e=>{postMessage({type:t,payload:n,result:e})})}};